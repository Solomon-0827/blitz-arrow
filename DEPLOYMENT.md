# ðŸš€ PPanel GCP éƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£æä¾›ä¸¤ç§éƒ¨ç½²æ–¹æ¡ˆï¼Œæ ¹æ®æ‚¨çš„ç½‘ç»œçŽ¯å¢ƒå’Œéœ€æ±‚é€‰æ‹©ã€‚

---

## ðŸ“Š æ–¹æ¡ˆå¯¹æ¯”

| ç‰¹æ€§           | æ–¹æ¡ˆ Aï¼šè™šæ‹Ÿæœºç›´æŽ¥æž„å»º | æ–¹æ¡ˆ Bï¼šæœ¬åœ°æž„å»º + Docker Hub |
| -------------- | ---------------------- | ----------------------------- |
| **æž„å»ºä½ç½®**   | GCP è™šæ‹Ÿæœº             | æœ¬åœ° Mac                      |
| **æž„å»ºæ—¶é—´**   | 15-20 åˆ†é’Ÿ             | æœ¬åœ° 10 åˆ†é’Ÿ + è™šæ‹Ÿæœº 2 åˆ†é’Ÿ  |
| **ç½‘ç»œè¦æ±‚**   | è™šæ‹Ÿæœºéœ€è¦è‰¯å¥½ç½‘ç»œ     | æœ¬åœ°éœ€è¦è®¿é—® Docker Hub       |
| **è™šæ‹Ÿæœºé…ç½®** | éœ€è¦ 2GB+ å†…å­˜         | 1GB å³å¯                      |
| **æŽ¨èåœºæ™¯**   | ç½‘ç»œç¨³å®šï¼Œé¦–æ¬¡éƒ¨ç½²     | é¢‘ç¹æ›´æ–°ï¼Œç½‘ç»œä¸ç¨³å®š          |

---

## ðŸŽ¯ æ–¹æ¡ˆ Aï¼šè™šæ‹Ÿæœºç›´æŽ¥æž„å»ºï¼ˆæŽ¨èé¦–æ¬¡éƒ¨ç½²ï¼‰

### ä¼˜ç‚¹

- âœ… ä¸éœ€è¦ Docker Hub è´¦å·
- âœ… ä¸éœ€è¦æŽ¨é€é•œåƒ
- âœ… æž¶æž„è‡ªåŠ¨åŒ¹é…ï¼ˆAMD64ï¼‰

### ç¼ºç‚¹

- âŒ æž„å»ºæ—¶é—´è¾ƒé•¿ï¼ˆ15-20 åˆ†é’Ÿï¼‰
- âŒ éœ€è¦è¾ƒå¤§è™šæ‹Ÿæœºé…ç½®ï¼ˆ2GB+ å†…å­˜ï¼‰
- âŒ æ¯æ¬¡æ›´æ–°éƒ½éœ€è¦å®Œæ•´æž„å»º

### ðŸ“‹ éƒ¨ç½²æ­¥éª¤

#### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºå¹¶é…ç½® GCP è™šæ‹Ÿæœº

1. æ‰“å¼€ [GCP æŽ§åˆ¶å°](https://console.cloud.google.com/compute/instances)
2. åˆ›å»ºè™šæ‹Ÿæœºå®žä¾‹ï¼š
   - **æœºå™¨ç±»åž‹**ï¼še2-mediumï¼ˆ2 vCPU, 4GB RAMï¼‰
   - **æ“ä½œç³»ç»Ÿ**ï¼šDebian 12
   - **ç£ç›˜**ï¼š20GB æ ‡å‡†æ°¸ä¹…ç£ç›˜
   - **é˜²ç«å¢™**ï¼šå…è®¸ HTTP å’Œ HTTPS æµé‡

#### ç¬¬äºŒæ­¥ï¼šè¿žæŽ¥è™šæ‹Ÿæœº

ç‚¹å‡»è™šæ‹Ÿæœºæ—çš„ **SSH** æŒ‰é’®

#### ç¬¬ä¸‰æ­¥ï¼šåˆå§‹åŒ–çŽ¯å¢ƒ

```bash
# å…‹éš†ä»£ç ä»“åº“
cd ~
git clone https://github.com/YOUR_USERNAME/YOUR_REPO.git
cd YOUR_REPO

# è¿è¡Œåˆå§‹åŒ–è„šæœ¬ï¼ˆå®‰è£… Docker ç­‰ï¼‰
chmod +x deploy/1-setup-vm.sh
./deploy/1-setup-vm.sh
```

**âš ï¸ é‡è¦**ï¼šè„šæœ¬å®ŒæˆåŽï¼Œè¾“å…¥ `exit` é€€å‡º SSHï¼Œç„¶åŽé‡æ–°è¿žæŽ¥ã€‚

#### ç¬¬å››æ­¥ï¼šéƒ¨ç½²åº”ç”¨

```bash
cd ~/YOUR_REPO

# ä¸€é”®éƒ¨ç½²
./scripts/deploy-from-source.sh
```

â³ **ç­‰å¾… 15-20 åˆ†é’Ÿ**ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨ï¼š

1. å®‰è£… Bun
2. å®‰è£…ä¾èµ–
3. æž„å»º Next.js åº”ç”¨
4. åˆ›å»º Docker é•œåƒ
5. å¯åŠ¨å®¹å™¨

#### ç¬¬äº”æ­¥ï¼šé…ç½®é˜²ç«å¢™

1. è¿›å…¥ [GCP é˜²ç«å¢™è§„åˆ™](https://console.cloud.google.com/networking/firewalls/list)
2. ç‚¹å‡» **åˆ›å»ºé˜²ç«å¢™è§„åˆ™**
3. é…ç½®ï¼š
   - **åç§°**ï¼š`allow-ppanel`
   - **ç›®æ ‡**ï¼šç½‘ç»œä¸­çš„æ‰€æœ‰å®žä¾‹
   - **æ¥æº IPv4 èŒƒå›´**ï¼š`0.0.0.0/0`
   - **åè®®å’Œç«¯å£**ï¼šTCP - `3000,3001`
4. ç‚¹å‡» **åˆ›å»º**

#### ç¬¬å…­æ­¥ï¼šè®¿é—®åº”ç”¨

```
Admin ç®¡ç†åŽå°: http://YOUR_VM_IP:3000
User  ç”¨æˆ·å‰ç«¯: http://YOUR_VM_IP:3001
```

### ðŸ”„ æ›´æ–°åº”ç”¨

```bash
cd ~/YOUR_REPO
git pull
./scripts/deploy-from-source.sh
```

---

## ðŸš€ æ–¹æ¡ˆ Bï¼šæœ¬åœ°æž„å»º + Docker Hubï¼ˆæŽ¨èé¢‘ç¹æ›´æ–°ï¼‰

### ä¼˜ç‚¹

- âœ… æž„å»ºé€Ÿåº¦å¿«ï¼ˆæœ¬åœ°æ€§èƒ½æ›´å¥½ï¼‰
- âœ… è™šæ‹Ÿæœºé…ç½®è¦æ±‚ä½Žï¼ˆ1GB å³å¯ï¼‰
- âœ… éƒ¨ç½²é€Ÿåº¦å¿«ï¼ˆ2-3 åˆ†é’Ÿï¼‰
- âœ… é€‚åˆé¢‘ç¹æ›´æ–°

### ç¼ºç‚¹

- âŒ éœ€è¦ Docker Hub è´¦å·
- âŒ éœ€è¦æŽ¨é€é•œåƒåˆ°å…¬å…±ä»“åº“
- âŒ æœ¬åœ°éœ€è¦è‰¯å¥½çš„ç½‘ç»œè®¿é—® Docker Hub

### ðŸ“‹ éƒ¨ç½²æ­¥éª¤

#### å‡†å¤‡å·¥ä½œ

1. **æ³¨å†Œ Docker Hub è´¦å·**ï¼šhttps://hub.docker.com/signup
2. **ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ç”¨æˆ·å**ï¼š
   - ç¼–è¾‘ `scripts/build-and-push.sh` ç¬¬ 9 è¡Œ
   - ç¼–è¾‘ `scripts/deploy-from-registry.sh` ç¬¬ 9 è¡Œ
   - å°† `DOCKER_USERNAME="huyedong"` æ”¹ä¸ºä½ çš„ç”¨æˆ·å

#### ç¬¬ä¸€æ­¥ï¼šåœ¨æœ¬åœ°æž„å»ºå¹¶æŽ¨é€é•œåƒ

```bash
cd /path/to/your/project

# ç™»å½• Docker Hub
docker login
# è¾“å…¥ä½ çš„ Docker Hub ç”¨æˆ·åå’Œå¯†ç 

# æž„å»ºå¹¶æŽ¨é€é•œåƒï¼ˆ5-10 åˆ†é’Ÿï¼‰
./scripts/build-and-push.sh
```

**è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š**

1. âœ… å®‰è£…ä¾èµ–
2. âœ… æž„å»º Next.js åº”ç”¨
3. âœ… æž„å»º Docker é•œåƒï¼ˆæ”¯æŒ AMD64ï¼‰
4. âœ… æŽ¨é€åˆ° Docker Hub

#### ç¬¬äºŒæ­¥ï¼šåœ¨è™šæ‹Ÿæœºä¸Šéƒ¨ç½²

```bash
# SSH è¿žæŽ¥åˆ°è™šæ‹Ÿæœº
cd ~/YOUR_REPO

# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# å¿«é€Ÿéƒ¨ç½²ï¼ˆ1-2 åˆ†é’Ÿï¼‰
./scripts/deploy-from-registry.sh
```

**è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š**

1. âœ… ä»Ž Docker Hub æ‹‰å–é•œåƒ
2. âœ… å¯åŠ¨å®¹å™¨

#### ç¬¬ä¸‰æ­¥ï¼šé…ç½®é˜²ç«å¢™ï¼ˆåŒæ–¹æ¡ˆ Aï¼‰

#### ç¬¬å››æ­¥ï¼šè®¿é—®åº”ç”¨ï¼ˆåŒæ–¹æ¡ˆ Aï¼‰

### ðŸ”„ æ›´æ–°åº”ç”¨

```bash
# æœ¬åœ°ï¼šæž„å»ºå¹¶æŽ¨é€æ–°é•œåƒ
./scripts/build-and-push.sh

# è™šæ‹Ÿæœºï¼šæ‹‰å–å¹¶éƒ¨ç½²
cd ~/YOUR_REPO
git pull
./scripts/deploy-from-registry.sh
```

---

## ðŸ”§ å¸¸è§é—®é¢˜

### 1. è™šæ‹Ÿæœºæž„å»ºæŠ¥é”™ `border-border` ç±»ä¸å­˜åœ¨

**åŽŸå› **ï¼šTailwind CSS é…ç½®é—®é¢˜

**è§£å†³**ï¼š

```bash
cd ~/YOUR_REPO
git pull # æ‹‰å–æœ€æ–°ä¿®å¤
rm -rf apps/*/.next .turbo
./scripts/deploy-from-source.sh
```

### 2. è™šæ‹Ÿæœºæž„å»ºè¢« Killed

**åŽŸå› **ï¼šå†…å­˜ä¸è¶³

**è§£å†³æ–¹æ¡ˆ A**ï¼šæ·»åŠ  Swap

```bash
sudo fallocate -l 4G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
free -h # éªŒè¯
```

**è§£å†³æ–¹æ¡ˆ B**ï¼šå‡çº§è™šæ‹Ÿæœºåˆ° e2-mediumï¼ˆ2GB+ å†…å­˜ï¼‰

### 3. æœ¬åœ°æž„å»ºè¶…æ—¶æ— æ³•è®¿é—® Docker Hub

**åŽŸå› **ï¼šç½‘ç»œè¿žæŽ¥ Docker Hub è¶…æ—¶

**è§£å†³æ–¹æ¡ˆ A**ï¼šé…ç½® Docker é•œåƒåŠ é€Ÿå™¨

```bash
sudo tee /etc/docker/daemon.json > /dev/null << 'EOF'
{
  "registry-mirrors": [
    "https://docker.m.daocloud.io",
    "https://docker.1panel.live"
  ]
}
EOF

# é‡å¯ Docker Desktop
```

**è§£å†³æ–¹æ¡ˆ B**ï¼šä½¿ç”¨æ–¹æ¡ˆ Aï¼ˆè™šæ‹Ÿæœºç›´æŽ¥æž„å»ºï¼‰

### 4. Docker é•œåƒå¹³å°ä¸åŒ¹é…

**é”™è¯¯ä¿¡æ¯**ï¼š`The requested image's platform (linux/arm64) does not match the detected host platform (linux/amd64)`

**è§£å†³**ï¼šä½¿ç”¨æ–¹æ¡ˆ B çš„ `build-and-push.sh`ï¼Œå®ƒä¼šè‡ªåŠ¨æž„å»º AMD64 é•œåƒ

---

## ðŸ“ ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹å®¹å™¨çŠ¶æ€

```bash
# æ–¹æ¡ˆ A
docker compose -f /tmp/docker-compose-local.yml ps

# æ–¹æ¡ˆ B
docker compose -f /tmp/docker-compose-registry.yml ps
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
docker compose -f /tmp/docker-compose-local.yml logs

# æŸ¥çœ‹å®žæ—¶æ—¥å¿—
docker compose -f /tmp/docker-compose-local.yml logs -f

# åªçœ‹ admin æ—¥å¿—
docker compose -f /tmp/docker-compose-local.yml logs -f admin

# åªçœ‹ user æ—¥å¿—
docker compose -f /tmp/docker-compose-local.yml logs -f user
```

### é‡å¯åº”ç”¨

```bash
# é‡å¯æ‰€æœ‰å®¹å™¨
docker compose -f /tmp/docker-compose-local.yml restart

# é‡å¯å•ä¸ªå®¹å™¨
docker compose -f /tmp/docker-compose-local.yml restart admin
```

### åœæ­¢åº”ç”¨

```bash
docker compose -f /tmp/docker-compose-local.yml down
```

### æ¸…ç†èµ„æº

```bash
# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker image prune -a

# æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„èµ„æº
docker system prune -a
```

---

## ðŸŽ¯ æŽ¨èéƒ¨ç½²æµç¨‹

### é¦–æ¬¡éƒ¨ç½²

1. **ä½¿ç”¨æ–¹æ¡ˆ A**ï¼ˆè™šæ‹Ÿæœºç›´æŽ¥æž„å»ºï¼‰
2. ç¡®ä¿ä¸€åˆ‡æ­£å¸¸è¿è¡Œ
3. å¦‚æžœåŽç»­éœ€è¦é¢‘ç¹æ›´æ–°ï¼Œåˆ‡æ¢åˆ°æ–¹æ¡ˆ B

### é¢‘ç¹æ›´æ–°

1. **ä½¿ç”¨æ–¹æ¡ˆ B**ï¼ˆæœ¬åœ°æž„å»º + Docker Hubï¼‰
2. æœ¬åœ°å¼€å‘å®ŒæˆåŽï¼Œè¿è¡Œ `build-and-push.sh`
3. è™šæ‹Ÿæœºä¸Šè¿è¡Œ `deploy-from-registry.sh`
4. æ•´ä¸ªæµç¨‹ 5-10 åˆ†é’Ÿå®Œæˆ

---

## ðŸ” å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤ç«¯å£**ï¼šå°† 3000/3001 æ”¹ä¸ºå…¶ä»–ç«¯å£
2. **é…ç½® HTTPS**ï¼šä½¿ç”¨ Nginx + Let's Encrypt
3. **é™åˆ¶é˜²ç«å¢™**ï¼šä»…å…è®¸å¿…è¦çš„ IP è®¿é—®
4. **å®šæœŸæ›´æ–°**ï¼šåŠæ—¶æ›´æ–°ä¾èµ–å’Œç³»ç»Ÿ

---

## ðŸ“š ç›¸å…³æ–‡æ¡£

- **å¿«é€Ÿå¼€å§‹**ï¼š`å¿«é€Ÿå¼€å§‹.md`
- **è™šæ‹Ÿæœºåˆå§‹åŒ–è„šæœ¬**ï¼š`deploy/1-setup-vm.sh`
- **æœ¬åœ°æž„å»ºè„šæœ¬**ï¼š`scripts/build-and-push.sh`
- **è™šæ‹Ÿæœºæž„å»ºè„šæœ¬**ï¼š`scripts/deploy-from-source.sh`
- **Docker Hub éƒ¨ç½²è„šæœ¬**ï¼š`scripts/deploy-from-registry.sh`

---

## ðŸ’¡ æç¤º

- é¦–æ¬¡éƒ¨ç½²å»ºè®®ä½¿ç”¨**æ–¹æ¡ˆ A**ï¼Œç¨³å®šåŽå†è€ƒè™‘**æ–¹æ¡ˆ B**
- å¦‚æžœç½‘ç»œä¸ç¨³å®šï¼Œä¼˜å…ˆä½¿ç”¨**æ–¹æ¡ˆ A**
- å¦‚æžœéœ€è¦é¢‘ç¹æ›´æ–°ï¼Œä¼˜å…ˆä½¿ç”¨**æ–¹æ¡ˆ B**
- ç”Ÿäº§çŽ¯å¢ƒå»ºè®®é…ç½® CI/CD è‡ªåŠ¨åŒ–éƒ¨ç½²

---

æœ‰é—®é¢˜éšæ—¶æŸ¥çœ‹æ–‡æ¡£æˆ–æ Issueï¼ðŸš€
